# Feature: Link Previews / URL Unfurling — DONE

**Completed by:** Agent b52583f5 (Task 12139605)
**Status:** Complete

## Summary

Implemented link previews (URL unfurling) for the chat app. When a user sends a message containing a URL, the app automatically fetches metadata (title, description, image, site name) from that URL and displays a rich preview card below the message text.

## Changes Made

### Schema (`convex/schema.ts`)
- Added `linkPreviews` table with fields: `messageId`, `url`, `title`, `description`, `imageUrl`, `siteName`, `domain`, `fetchedAt`
- Added `by_messageId` index

### Backend (`convex/linkPreviews.ts`) — NEW FILE
- `fetchLinkPreview` (internal action): Fetches URL, parses HTML for OG/meta tags using regex, extracts title/description/image/siteName, with 5s timeout and 50KB body limit. Only processes text/html responses.
- `saveLinkPreview` (internal mutation): Stores preview data, deduplicates by messageId+url
- `getLinkPreviews` (query): Batch query by messageIds using index, returns flat array of previews

### Message Integration (`convex/messages.ts`)
- `sendMessage`: After inserting message, extracts URLs via regex, schedules `fetchLinkPreview` for up to 3 unique URLs per message (non-blocking via `ctx.scheduler.runAfter`)
- `deleteMessage`: Cleans up associated link previews when a message is deleted

### Frontend Component (`src/components/LinkPreview.tsx`) — NEW FILE
- Dark card matching zinc theme (bg-zinc-800/50, border-zinc-700)
- Thumbnail image on left (80x80, rounded, with error handling)
- Title (zinc-100, bold, 1-line clamp), description (zinc-400, 2-line clamp), domain (zinc-500)
- Entire card is a clickable link opening in new tab

### Frontend Integration
- **MessageItem.tsx**: Accepts optional `linkPreviews` prop, renders `<LinkPreview>` cards after message text and before thread indicator
- **MessageList.tsx**: Queries `api.linkPreviews.getLinkPreviews` for all visible message IDs, groups by messageId, passes to each `<MessageItem>`
- **ThreadPanel.tsx**: Same pattern — queries link previews for parent + replies, renders them in both the parent message display and reply MessageItems

## TypeScript Validation
- All link preview files compile cleanly with `pnpm -s tsc -p tsconfig.json --noEmit`
- Convex codegen succeeds
